<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Triple Burry</title>
  <link rel="stylesheet" href="../css/auth.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
  <main class="wrap">
    <section class="auth-card" aria-labelledby="signin-title">
      <h2 id="signin-title" class="title">Sign In To Triple Burry</h2>

      <div class="providers">
        <button class="btn btn-provider" type="button">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="" />
          <span>Sign in with Google</span>
        </button>
        <button class="btn btn-provider" type="button">
          <img src="https://upload.wikimedia.org/wikipedia/commons/8/8c/Gmail_Icon_%282013-2020%29.svg" alt="" />
          <span>Sign in with Email</span>
        </button>
      </div>

      <div class="divider" role="separator" aria-label="or">— OR —</div>

      <form id="signinForm" class="form" novalidate>
        <label class="field">
          <span class="label">Email</span>
          <input type="email" name="email" placeholder="you@example.com" required>
        </label>

        <label class="field">
          <span class="label">Password</span>
          <input type="password" name="password" placeholder="••••••••" required>
        </label>

        <button id="signinBtn" class="btn btn-primary" type="button">Sign in</button>

        <p class="sub-actions">
          <a class="muted" href="signup.html">Register Now</a>
          <a class="muted" href="#">Forgot Password?</a>
        </p>
      </form>
    </section>
  </main>

  <script type="module">
import { signIn, currentUser, signOut } from '../JS/auth.js';

// ล้าง session เก่าเพื่อเริ่ม login ใหม่ทุกครั้ง
signOut();

// เช็คว่า user already logged in (หลัง signOut แล้วปกติจะไม่มี)
const me = currentUser();
if (me) {
  location.href = (me.role === 'admin') ? '../admin/Dashboard.html' : '../Home.html';
}

// ป้องกัน form submit รีเฟรชหน้า
document.getElementById('signinForm')?.addEventListener('submit', e => e.preventDefault());

const btn = document.getElementById('signinBtn');
btn.addEventListener('click', () => {
  const email = document.querySelector('input[name="email"]').value.trim();
  const pw    = document.querySelector('input[name="password"]').value;

  try {
    // login และสร้าง session ใหม่
    const s = signIn(email, pw);

    // redirect ตาม role
    if (s.role === 'admin') {
      location.href = '../admin/Dashboard.html';
    } else {
      location.href = '../Promotion.html';
    }

  } catch (err) {
    alert(err.message || 'Sign in failed');
  }
});
</script>



</body>

</html>
